<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鎖匙扣管理App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
    body { 
        font-family: 'Noto Sans TC', sans-serif; 
        background: url('https://media.karousell.com/media/photos/products/2020/12/15/________1608049137_0ca655bc_progressive.jpg') no-repeat center center fixed; 
        background-size: cover; /* 讓圖片滿版 */
        overflow: auto; /* 允許必要滾動，但防過度滾動 bug */
    }
    .card { 
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
        background-color: rgba(255, 255, 255, 0.8); /* 半透明卡片，避免背景太亂 */
    }
    .btn-custom { background-color: #007bff; color: white; }
    .btn-custom:hover { background-color: #0056b3; }
    #back-to-top { position: fixed; bottom: 20px; right: 20px; display: none; z-index: 1000; }
    #home .nav-link { border-radius: 20px; } /* 圓角按鈕 */
    #home, #draw, #archive { min-height: 100vh; padding-top: 20px; } /* 滿屏 + 間距，修滾動 bug */
    #login-section { min-height: 100vh; } /* 登入頁也滿屏 */
        .keychain-img { width: 50px; height: 50px; object-fit: cover; margin-left: 10px; border-radius: 5px; } /* 新增：圖片縮圖樣式 */

</style>
    <!-- Firebase Compat SDK -->
    <script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container mt-5">
        <!-- 登入區 (無任何分頁或登出按鈕) -->
        <div id="login-section" class="card p-4" style="display: block;">
            <h2 class="text-center">登入以同步資料</h2>
            <input type="email" id="email" class="form-control mb-2" placeholder="Email">
            <input type="password" id="password" class="form-control mb-2" placeholder="密碼" onkeydown="if(event.key==='Enter') login()">
            <button class="btn btn-custom w-100" onclick="login()">登入</button>
            <button class="btn btn-secondary w-100 mt-2" onclick="register()">註冊</button>
        </div>

        <!-- 主頁導航 (改為獨立 card + 小導航條 + 大按鈕) -->
        <div id="home" class="card p-4" style="display:none;">
 
            <h2 class="text-center">主頁</h2>
            <p class="text-center text-muted">歡迎回來！選擇您的功能。</p>
            <ul class="nav nav-pills flex-column align-items-center">
                <li class="nav-item m-2">
                    <a class="nav-link btn-custom btn-lg px-5 py-4 fs-1" href="#draw">抽籤</a>
                </li>
                <li class="nav-item m-2">
                    <a class="nav-link btn-custom btn-lg px-5 py-4 fs-1" href="#archive">檔案庫</a>
                </li>
                <li class="nav-item m-2">
                    <button class="nav-link btn-custom btn-lg px-5 py-4 fs-1" onclick="logout()">登出</button>
                </li>
            </ul>
        </div>

        <!-- 抽籤頁 (有小導航條，無登出) -->
        <div id="draw" class="card p-4" style="display:none;">
            <!-- 最上方小導航條 -->
            <ul class="nav nav-pills flex-row mb-3">
                <li class="nav-item me-2">
                    <a class="nav-link btn-custom btn-sm" href="#home">主頁</a>
                </li>
                <li class="nav-item me-2">
                    <a class="nav-link btn-custom btn-sm active" href="#draw">抽籤</a>
                </li>
                <li class="nav-item me-2">
                    <a class="nav-link btn-custom btn-sm" href="#archive">檔案庫</a>
                </li>
            </ul>
            <h2>抽籤</h2>
            <p class="text-center text-muted">歡迎使用鎖匙扣抽籤工具！新增您的鎖匙扣並開始抽取吧。</p>
            <div class="mb-3">
                <input type="text" id="new-keychain" class="form-control d-inline-block w-50" placeholder="新增鎖匙扣名稱" onkeydown="if(event.key==='Enter') addKeychain()">
                <input type="file" id="new-keychain-image" class="form-control d-inline-block w-auto ms-2" accept="image/*"> <!-- 新增：圖片上傳輸入 -->
                <button class="btn btn-custom ms-2" onclick="addKeychain()">新增</button>
                <button class="btn btn-custom ms-2" onclick="shuffleOrder()">隨機排序</button>
            </div>
            <div class="mb-3">
                <button class="btn btn-custom" onclick="drawKeychain()">抽一隻</button>
                <button class="btn btn-warning ms-2" onclick="resetDraw()">重置抽籤記錄</button>
            </div>
            <div id="result" class="mt-3 alert alert-info"></div>
            <h3>鎖匙扣列表</h3>
            <ul id="simple-list" class="list-group mt-3"></ul> <!-- 這裡會在JS中顯示圖片 -->
        </div>

        <!-- 檔案庫頁 (有小導航條，無登出) -->
        <div id="archive" class="card p-4" style="display:none;">
            <!-- 最上方小導航條 -->
            <ul class="nav nav-pills flex-row mb-3">
                <li class="nav-item me-2">
                    <a class="nav-link btn-custom btn-sm" href="#home">主頁</a>
                </li>
                <li class="nav-item me-2">
                    <a class="nav-link btn-custom btn-sm" href="#draw">抽籤</a>
                </li>
                <li class="nav-item me-2">
                    <a class="nav-link btn-custom btn-sm active" href="#archive">檔案庫</a>
                </li>
            </ul>
            <h2>鎖匙扣檔案庫</h2>
            <div class="d-flex justify-content-between align-items-center mb-3"> <!-- 新包裝 div，讓按鈕左、文字中 -->
                <button class="btn btn-sm btn-warning" onclick="resetAllStatus()"><i class="fas fa-undo"></i> 重置所有狀態</button> <!-- 新按鈕 -->
                <p class="text-center text-muted flex-grow-1 m-0">這裡管理您的所有鎖匙扣，編輯狀態和查看統計。</p>
            </div>
            <ul id="keychain-list" class="list-group mt-3"></ul>  <!-- 這裡會在JS中添加file input和顯示圖片 -->
            <h3>統計與歷史</h3>
            <div id="total-stats" class="mt-3 alert alert-secondary"></div>
            <ul id="stats-list" class="list-group mt-3"></ul>
        </div>
    </div>
    <!-- 一鍵到頂按鈕 -->
    <button id="back-to-top" class="btn btn-custom"><i class="fas fa-arrow-up"></i> 到頂</button>
    
    <!-- Firebase Config -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA2iBUs4yLgHTpk-woUrUXboug_N-3YL7M",
            authDomain: "ahl4-key.firebaseapp.com",
            projectId: "ahl4-key",
            storageBucket: "ahl4-key.firebasestorage.app",
            messagingSenderId: "666533647782",
            appId: "1:666533647782:web:d26cd0dc4b03ac8733ab67",
            measurementId: "G-VG3HWXTDJ4"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    
    <!-- app.js -->
    <script src="app.js"></script>
</body>
</html>